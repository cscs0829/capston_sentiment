#   감정 진단 AI를 활용한 라이트 테라피 조명 개발

##   프로젝트 개요

본 프로젝트는 AI 기술을 활용하여 사용자의 감정 상태를 진단하고, 그에 맞는 라이트 테라피를 제공하는 조명 시스템을 개발합니다. 이 시스템은 사용자의 감정 상태를 정확하게 파악하고, 심리적 안정과 긍정적인 감정 증진을 돕는 것을 목표로 합니다.

##   팀 구성

선예빈 최승희 정효원 박창선

##  대표사진
<img width="985" alt="스크린샷 2025-03-17 오후 6 36 43" src="https://github.com/user-attachments/assets/429b0997-619b-4327-8174-840594b3fa53" />


##   7. 기술 스택

###   소프트웨어 및 라이브러리

* Python
* KcBERT
* TensorFlow / PyTorch (KcBERT 기반)
* Streamlit
* Pygame
* serial (시리얼 통신)
* numpy
* scipy

###   하드웨어

* 미니 PC
* 아두이노 UNO
* LED (네오픽셀 스트립)
* 스피커
* 스위치

###   데이터셋 구성

* 한국어 감정 정보가 포함된 단발성 대화 데이터셋
* 한국어 감정 정보가 포함된 연속성 대화 데이터셋

###   데이터셋 처리

* 단발성 대화 데이터셋은 학습 데이터로, 연속적 대화 데이터셋은 테스트 데이터로 사용
* 문장 단위 작업을 위해 문장 분리 작업 수행
* 7가지 감정 (공포, 놀람, 분노, 슬픔, 중립, 행복, 혐오) 레이블링 수행
   ![image](https://github.com/user-attachments/assets/95506a89-7317-4617-b06b-996247fe1de2)


###   데이터셋 예시

|   id   | document                               | label   |
| :----: | :------------------------------------- | :-----: |
|   1    | 언니 동생으로 부르는게 맞는 일인가요..? |   공포    |
|   2    | 그냥 내 느낌일뿐겠지?                   |   공포    |
|   3    | 아직너무초기라서 그런거죠?               |   공포    |
|  ...   | ...                                    |  ...   |

###   소프트웨어 구성 요소

* **AI 모델**: KcBERT 모델을 사용하여 감정 진단
* **감정 분석**: 텍스트 입력으로부터 감정을 분석하고, '분노', '슬픔', '행복' 외 4가지 감정으로 분류 [cite: 5]
* **라이트 테라피**: 감정 분석 결과에 따라 LED 색상을 출력하여 심리적 안정 유도 [cite: 7]
* **뮤직 테라피**: 감정 분석 결과에 따라 음악을 출력하고, 음악 크기에 따라 빛의 세기를 PWM 제어 [cite: 7]
* **스위치 제어**: 스위치를 통해 조명 및 음악을 끄는 기능 제공

###   AI 모델 (KcBERT)

* 2018년 구글이 공개한 사전 훈련된 BERT 모델 기반 [cite: 26, 27]
* 한국어에 특화된 BERT 변형 모델로, 한국어 문법, 어휘, 문화적 특성을 반영하여 훈련 [cite: 28, 29]
* 문맥 이해와 언어 의미 파악에 뛰어나며, 다양한 한국어 자연어 처리 작업에서 높은 성능 발휘 [cite: 28, 29]

###   AI 모델 구현

**Python 환경 설정**: Github 파일 가져오기, 라이브러리 import, 필요 라이브러리 설치 [cite: 31]
   **데이터셋 전처리**: 입력 문장 토큰화, 최대 길이로 패딩
   **데이터 로딩**: 엑셀 파일에서 데이터 로드, 결측치 제거, 감정 레이블을 숫자로 변환, DatasetDict 형식으로 데이터셋 생성
   **모델 학습 및 평가**: Trainer 객체를 사용하여 모델 학습 및 평가, 학습/평가 과정 파라미터 설정 [cite: 35]
   **KcBERT 모델 구현**:
    * 주론 함수 정의: 입력 텍스트에 대한 감정 분석 결과 반환
    * Streamlit 인터페이스 설정: 사용자 입력 텍스트 영역 제공
   **모델 성능 평가**: 5번의 학습 결과, 모델 예측 정확도 평균 85% 확인
   **모델 테스트**:
**시리얼 통신 프로토콜**: 감정(색상) 및 진폭값에 따른 RGB 값 설정 

    |   감정(색상)    | 진폭값 |    RGB 값    |
    | :-------------: | :----: | :----------: |
    |   분노, 혐오(보라색)   |   60   |  (0, 30, 60)   |
    |    슬픔(파란색)    |   60   |  (0, 0, 60)   |
    |    행복(노랑색)    |   60   | (60, 60, 0)  |
    |   공포, 놀람(초록색)   |   60   |  (60, 0, 0)   |
    |       ...       |  ...   |     ...      |

**퓨리에 변환**: fft 함수를 사용하여 주파수 계산, Fourier 변환 수행, 주파수 범위 계산, 평균 진폭 계산, PWM 값 결정
**음악 신호 처리 (PWM 제어)**:
    * 감정에 따라 4개의 진폭값 범위 생성 및 진폭값 평균에 대한 주기 설정 
    * 음원 데이터에 대해 푸리에 변환 수행 및 주파수에 대한 진폭값 계산 
**결과값**: 1초마다 주파수의 진폭값 평균을 구하고 구간별로 설정한 값 출력 
**스위치 제어 (LED, 음악 off 기능)**:
    * 'monitor\_switch' 함수에서 시리얼 포트를 사용하여 스위치 상태 모니터링
    * 스위치 "STOP" 메시지 전송 시 프로그램 중지
**감정에 따른 LED, 음악 출력**: 


###   하드웨어 구성 요소

* 미니 PC [cite: 59]
* 아두이노 [cite: 59]
* LED [cite: 59]
* 스피커 [cite: 59]
* 스위치 [cite: 59]

###   회로도 구성

![image](https://github.com/user-attachments/assets/461624d3-af3b-4728-b62f-389e02332af9)

##   4. 프로젝트 이슈

1.  **LED 선택 문제**:
    * 렌즈 타입 LED RGB는 전용 컨트롤러로만 제어 가능하고 아두이노로는 제어 불가능 [cite: 64]
    * 네오픽셀 스트립 LED RGB는 아두이노로 제어 가능하고 PWM 제어(빛의 밝기 조절) 가능 [cite: 64]
2.  **GluonNLP 오류**:
    * 2023년 8월 Colab 업데이트 이후 GluonNLP에서 오류 발생 [cite: 67, 68, 69, 70]
    * Colab에서 Numpy 업데이트 확인 후 1.23.5 버전 설치하여 해결 [cite: 69, 70]
3.  **Colab-아두이노 시리얼 통신 문제**:
    * 클라우드 기반 Colab에서는 시리얼 통신을 통한 아두이노 연결 불가능 [cite: 73]
    * KcBERT AI 모델을 로컬 환경에서 실행 가능하도록 변경하여 해결 [cite: 76]
4.  **LED 불량**:
    * LED 불량으로 빨간색만 출력되는 문제 발생 [cite: 78]
    * LED 재구매를 통해 해결 [cite: 78]
5.  **RGB 값 오류**:
    * RGB 값을 모두 사용했을 때 원하는 색상이 나오지 않는 문제 발생 [cite: 80, 81]

    |   분노   |   슬픔   |   행복   |   놀람     |
    | :-----: | :-----: | :-----: | :-------: |
    | PWM 3,4 | 오류 없음 | PWM 8 오류 | PWM 13~16 오류 |

    * RGB 값을 1개 또는 2개로 사용하여 오류 해결 [cite: 81]
6.  **스위치 기능 오류**:
    * Playsound 모듈로는 스위치로 음악 제어 불가능
    * Pygame 모듈을 설치하여 해결 [cite: 85, 86]



